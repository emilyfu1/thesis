---
title: "Showing data work (for supervisory purposes)"
format: html
editor: visual
---

```{r echo=FALSE}
# import packages
library(ipumsr)
library(tidyverse)
```

## Loading ATUS data

```{r}
# package download message
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")


# define data extract DDI to use 
ATUS_ddi = 'atus_00001.xml'
ddi = read_ipums_ddi(ATUS_ddi)
# import data
data = read_ipums_micro(ddi)
```

There is data available from 2003 to 2024. Here, I take a look at a cross section for data exploration purposes.

```{r}
data_2016 = data |> filter(YEAR == 2016) |>
  # strata isn't right after 2016 but it was preselected so im removing it
  # SERIAL makes CASEID redundant
  select(-STRATA, -CASEID)
```

## First, work with household data

By splitting up the dataset by types of observations and then doing an inner merge myself, information collected at the household level can be used to populate the individual level data and vice versa. I think I'll have to construct my own data out of each type of observation because right now they all show up on separate lines. If I separate each type and merge them back together, I can fix this.

```{r}
# household level
data_2016_hh = data_2016 |>
  filter(RECTYPE == '1') |> # indicates a household observation) 
  
  # this will show all relevant varables collected at household level
  # it drops empty columns (i.e. data only collected for activities/individuals)
  select(where(~ !all(is.na(.)))) |>
  
  # drop rectype now in preparation for merge
  select(-RECTYPE)
```

## Now, look at individuals

This creates a dataset with observations for each person. Each household has a distinct household serial number, and all members of the household have the same serial number. I have ages for all household members. For the purpose of this exercise, I'm not too sure what I want to focus on yet. A good place to start could be nuclear heterosexual households (i.e. two parents, a male partner, a female partner, and children) since I want to look at inequality within the heteronormative household.

Literature on household inequality generally tends to and focuses on working couples *without* children, or models them as public goods. \[Arduini (2024)\]\[https://ifs.org.uk/sites/default/files/2025-05/WP202517-Estimating-intra-household-sharing-from-time-use-data.pdf\] uses the concept of private leisure time (time spent on leisure activities without other members of the household present) to estimate intra-household sharing. She defines the "assignable good", which is a private good

Since I wanted to study family-related stuff in the first place, to that end, I think it's worth taking a different look at the role children play in their households. What I originally thought to study were income effects on fertility, and some literature in that subject finds evidence for children being "normal goods" in the sense that fertility increases with income. Would it be reasonable to take the public goods approach, that both parents could allocate resources (time) to "producing the public good" (parenting their children so that they grow up to have characteristics that the family wants as a whole)? btw time spent caring for household children can be for non-own children too?

The question of how to deal with children is a big issue. Time spent parenting (maybe focus on solo parenting, i.e. without spouse present, could also do money spent on kids) has some of the same characteristics as private leisure time. Parenting is also an unpaid activity, but its value isn't really known (even for those who work) since children aren't true goods---they are autonomous people and have their own preferences/choices, especially in adulthood. Treating children as a private good, where each parent can spend more time and/or own resources on raising their shared children for some private benefit, not necessarily something that the other spouse can benefit from (like teaching your child traits that are socially undesirable but personally useful), is complicated and I'm not sure if it's defensible. However, it is essentially the other side of the same coin as private leisure time. The more parenting you do, the less private leisure time you usually get. I just think parenting would be an interesting angle to take if I want to focus on families. Even if I can't use solo parenting time as a way to measure household sharing, it could be interesting to try and use it to answer my original question about the normal-ness or inferior-ness of children. 

\[Andrew et al (2021)\]\[https://ifs.org.uk/inequality/wp-content/uploads/2021/03/BN-The-careers-and-time-use-of-mothers-and-fathers.pdf\] show that heteronormative households, mothers are more likely to leave the labour force after having children regardless of the relative wages between mother and father before childbirth. (Much of the recent literature in this area focuses on COVID-19, maybe look into this.) It's difficult to really prove who in a relationship is doing the colloquially-named "mental load" of parenting (stuff like keeping appointments, planning meals, remembering when the laundry was last done), although anecdotally this is usually the wife or mother's job in this kind of household. (There may be a time use paper somewhere that tries to deal with this, maybe look into this). The ATUS records time spent doing activities, but not the thoughts that go on in someone's head. It also records the people present during an activity, but not, as far as I've seen, who is a active participant, or if someone needs to be actively prompted to do the groceries or pick up after a child.

\[Dunbar et al (2013)\]\[https://www.sfu.ca/\~pendakur/CollectiveChildren30-with-appendices.pdf\]: Geoff is looking at parents' and childrens' resource shares, I think I'd want to stick to the inequality of the couple. These parts are useful:

*"In models where goods are purely private or purely public, what we call private, assignable goods are known as exclusive goods. See, e.g. Bourguignon, Browning, and Chiappori (2009). Chiappori and Ekeland (2008) and Cherchye, De Rock and Vermeulen (2008) among others show how assignable goods can aid in the identification of resource shares. Our strategy follows this line in assuming the presence, and observability, of a small number of private assignable goods, and uses these to identify childrens’ resource shares. The end result is that we identify how total household expenditures on all goods are divided up among household members, just by observing how family expenditures on each member’s single private good (like clothing) vary with total expenditures."*

_"We find that children command a reasonably large share of resources – roughly 20 percent for the first child – and that this share rises with the number of children – 5-10 percentage points per additional child. Moreover, fathers command a larger share of resources than mothers, and mothers seem to sacrifice more resources than fathers to their children."_

_"A good is defined to be private if it cannot be shared or consumed jointly by more than one person, and is defined to be assignable if it is consumed by one individual household member that is known to the researcher. Examples could include toys and diapers which are private goods assignable to children, or alcohol and tobacco which are private goods assignable to adults. In our empirical application we use clothing"_

In an ideal world I'd take Geoff's use of children to measure intra-household inequality but use the time-use identification from Arduini. Something like taking time spent on phone calls about childrens' appointments, helping children with homework, stuff like that? From the documentation:

```
030101	Physical care for household children
030102	Reading to or with household children
030103	Playing with household children, not sports
030104	Arts and crafts with household children
030105	Playing sports with household children
030106	Talking with or listening to household children
030107	Helping or teaching household children (not related to education) (2003)
030108	Organization and planning for household children
030109	Looking after household children (as a primary activity)
030110	Attending household children's events
030111	Waiting for or with household children
030112	Picking up or dropping off household children
030199	Caring for and helping household children, n.e.c.
030201	Homework (household children)	
030202	Meetings and school conferences (household children)	
030203	Home schooling of household children	
030204	Waiting associated with household children's education
030299	Activities related to household child's education, n.e.c.
160103	Telephone calls to or from education services providers
160107	Telephone calls to or from paid child or adult care providers
180301	Travel related to caring for and helping household children, inclusive (2003, 2004)
180302	Travel related to caring for and helping household children (2005+)
180303	Travel related to household children's education (2005+)
180304	Travel related to household children's health (2005+)
```

Data cleaning for individual-level data:
```{r}
data_2016_individual = data_2016 |>
  filter(RECTYPE == '2') |> # indicates a person
  # this will show all relevant varables collected at individual level
  select(where(~ !all(is.na(.)))) |>
  
  # there isn't a straightforward way to find parents/couples...
  # but this can help identify kids and adults
  mutate(is_adult = AGE >= 18) |>
  
  # drop rectype now in preparation for merge
  select(-RECTYPE) |>
  
  # do an actual merge of household data and individual data together 
  # merge on YEAR, SERIAL
  inner_join(data_2016_hh, by = c("YEAR", "SERIAL")) |>
  
  # how many adults/kids does each household have? 
  group_by(SERIAL) |>
    # count number of adults
    mutate(num_adults_in_HH = sum(AGE >= 18, na.rm = TRUE)) |>
    # now flag households that have exactly one male and one female adult
    mutate(has_hetero_parents = sum(SEX[is_adult] == 1, na.rm = TRUE) == 1 & 
           sum(SEX[is_adult] == 2, na.rm = TRUE) == 1) |> 
    # keep everyone in hh where both the respondent and spouse 
    # make positive income
    filter(any(EARNWEEK != 99999.99 & SPEARNWEEK != 99999.99 &
                 EARNWEEK > 0 & SPEARNWEEK > 0, na.rm = TRUE)) |>
  ungroup() |>

  # keep if heterosexual couple and children present in household
  filter(has_hetero_parents, 
         HH_CHILD == 1) |>
  
  # should probably generate an individual person identifier
  mutate(person_id = row_number())
```

## Activities and accompaniment

The ATUS has information about detailed activities and the people present during those activities. It also includes information on time spent taking care of children during those activities
```{r}
data_2016_who = data_2016 |>
  filter(RECTYPE == '4') |>
  select(where(~ !all(is.na(.)))) |>
  
  # drop rectype now in preparation for merge
  select(-RECTYPE) |>
  
  # to merge them together need to rename activity line number so its the same
  rename(ACTLINE = ACTLINEW)

data_2016_activities = data_2016 |>
  filter(RECTYPE == '3') |>
  select(where(~ !all(is.na(.)))) |>
  # drop rectype now in preparation for merge
  select(-RECTYPE) |>
  
  # merging activities with information about who does them
  # merge on YEAR, SERIAL, ACTLINE for the who data
  inner_join(data_2016_who, by = c("YEAR", "SERIAL", "ACTLINE")) |>
  
  # looks like WHOLINE in the who data aligns with LINENO in the individual data
  # and LINENOW in the who data is the person the activity was performed with 
  # confusing lmao
  # rename variables to make merging with individual level data possible
  rename(LINENO = WHOLINE, activity_done_with = LINENOW)
```

Now, it's possible to do this merge to the individual level data
```{r}
data_2016_merged = data_2016_individual |>
  # merge on YEAR, SERIAL, LINENO for the who data
  inner_join(data_2016_activities, by = c("YEAR", "SERIAL", "LINENO"))
```

Variables I will need:
`RELATEWU == 1` means an activity is done alone
`DURATION` provides duration of activity

Children and parents: I might want to look at a setup similar to DLP where there are father, mother, and child-type 
```{r}
# make a childrens' dataset and a parents' dataset separately

# parents
data_2016_adults = data_2016_merged |>
  filter(is_adult) |>
  select(where(~ !all(is.na(.))))
  
# kids
data_2016_kids = data_2016_merged |>
  filter(!is_adult) |>
  select(where(~ !all(is.na(.))))

```

## random summary statistics

```{r}
data_2016_individual |>
  summarise(
    min_kids   = min(HH_NUMKIDS, na.rm = TRUE),
    max_kids   = max(HH_NUMKIDS, na.rm = TRUE),
    mean_kids  = mean(HH_NUMKIDS, na.rm = TRUE),
    median_kids = median(HH_NUMKIDS, na.rm = TRUE),
    sd_kids    = sd(HH_NUMKIDS, na.rm = TRUE)
  )
```

```{r}
data_2016_adults %>%
  group_by(SEX) %>%
  summarise(mean_weekly_earnings = mean(EARNWEEK), n = n())
```